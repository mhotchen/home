# Signup

## Concepts

Two concepts: organization, user

Initial signup: create user, create org

Subsequent users: by invitation only

## Data

- Cognito: sub, email
- organizations table: uuid generated by backend, name
- users table: uuid generated by backend, cognito sub, organization
- organization invitations table: organization, email, invitation token, already used

## Services

- users: cognito handler for creating users
- organizations: organization creation, invitation handler

## Workflows

### Signup form

/organization/new

- Org name
- Email
- Password

User gets created in Cognito

- Handler that adds user to DB with no organization

POST /organizations

- If user is already associated with an org, reject
- Create organization, link user to it

### Invite form

/organization/invite

- Email

POST /organizations/mine/invitations

- Creates invitation object with an invitation token for same org as submitter
- Sends invitation email with link to invitation signup form with invitation token in URL

### Invitations signup form

/organization/invitations/{invitation-token}

- Email already filled out (GET /organizations/invitations/{invitation-token} - no auth required, must not already be used)
- Password

User gets created in Cognito

- Handler that adds user to DB with no organization

PUT /organizations/invitations/{invitation-token}/completions

- If user is already associated with an org, respond immediately with details
- Get invitation token, copy org from it to the user in the DB
- Mark the invitation token as already used

### Retrieving org details

/organization

GET /organizations/mine
